<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>অ্যাডমিন ড্যাশবোর্ড</title>
  <style>
    body, html {
      margin:0; padding:0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
      display: flex; flex-direction: column;
    }
    header {
      background: #2563eb;
      color: white;
      padding: 15px 20px;
      font-size: 22px;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select:none;
    }
    header button.logoutBtn {
      background: #f87171;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    header button.logoutBtn:hover {
      background: #dc2626;
    }
    main {
      flex: 1;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      overflow-x: auto;
    }
    h2 {
      color: #111827;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      text-align: left;
      padding: 12px 15px;
      border-bottom: 1px solid #e5e7eb;
    }
    th {
      background: #3b82f6;
      color: white;
    }
    tr:hover {
      background: #bfdbfe;
    }
    button.actionBtn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-right: 8px;
      transition: background-color 0.3s ease;
    }
    button.actionBtn:hover {
      background: #1e40af;
    }
    /* Responsive */
    @media (max-width:600px) {
      th, td {
        padding: 10px 8px;
        font-size: 14px;
      }
      header {
        font-size: 18px;
      }
      button.actionBtn {
        padding: 5px 8px;
        font-size: 13px;
        margin-right: 4px;
      }
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

<header>
  অ্যাডমিন ড্যাশবোর্ড
  <button class="logoutBtn" id="logoutBtn">লগআউট</button>
</header>

<main>
  <h2>ইউজার তালিকা</h2>
  <table id="userTable">
    <thead>
      <tr>
        <th>নাম</th>
        <th>স্ট্যাটাস</th>
        <th>অ্যাকশন</th>
      </tr>
    </thead>
    <tbody>
      <!-- ইউজাররা এখানে দেখানো হবে -->
    </tbody>
  </table>
</main>

<script>
  // তোমার Firebase config এখানে বসাও
  const firebaseConfig = {
    apiKey: "AIzaSyDJ_KagqCQzTavn4SU81g9XV29k76cNLF8",
    authDomain: "pakhi-e3aad.firebaseapp.com",
    projectId: "pakhi-e3aad",
    storageBucket: "pakhi-e3aad.firebasestorage.app",
    messagingSenderId: "235336322769",
    appId: "1:235336322769:web:6400ff0350ea3c60e2fff0"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const logoutBtn = document.getElementById('logoutBtn');

  // লগআউট বাটন ক্লিক করলে localStorage থেকে লগইন ডেটা মুছে ফেলে লগইন পেজে পাঠাবে
  logoutBtn.onclick = () => {
    localStorage.removeItem('adminLoggedIn');
    window.location.href = 'admin-login.html';
  };

  // ইউজার তালিকা লোড করার ফাংশন
  function loadUsers() {
    const tbody = document.querySelector('#userTable tbody');
    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">লোড হচ্ছে...</td></tr>';

    db.collection('users').get().then(snapshot => {
      tbody.innerHTML = ''; // ক্লিয়ার

      if (snapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">কোনো ইউজার পাওয়া যায়নি।</td></tr>';
        return;
      }

      snapshot.forEach(doc => {
        const user = doc.data();
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${user.name || '-'}</td>
          <td>${user.banned ? '<span style="color:red;">ব্যান</span>' : '<span style="color:green;">সক্রিয়</span>'}</td>
          <td>
            <button class="actionBtn" onclick="toggleBan('${doc.id}', ${user.banned ? 'false' : 'true'})">
              ${user.banned ? 'আনব্যান' : 'ব্যান'}
            </button>
            <button class="actionBtn" onclick="deleteUser('${doc.id}')"
              style="background:#dc2626;">ডিলিট</button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    }).catch(err => {
      tbody.innerHTML = '<tr><td colspan="3" style="color:red;text-align:center;">ত্রুটি ঘটেছে: '+ err.message +'</td></tr>';
    });
  }

  // ইউজারকে banned/active করার ফাংশন
  function toggleBan(userId, banStatus) {
    if (!confirm(banStatus ? 'নিশ্চিত আপনি ইউজারকে BAN করতে চান?' : 'নিশ্চিত আপনি ইউজারকে UNBAN করতে চান?')) return;

    db.collection('users').doc(userId).update({
      banned: banStatus
    }).then(() => {
      alert('সফলভাবে স্ট্যাটাস পরিবর্তন হয়েছে।');
      loadUsers();
    }).catch(err => {
      alert('ত্রুটি ঘটেছে: ' + err.message);
    });
  }

  // ইউজার ডিলিট ফাংশন
  function deleteUser(userId) {
    if (!confirm('নিশ্চিত আপনি ইউজারকে ডিলিট করতে চান? এই কাজ অপরিবর্তনীয়।')) return;

    db.collection('users').doc(userId).delete()
    .then(() => {
      alert('ইউজার সফলভাবে ডিলিট হয়েছে।');
      loadUsers();
    })
    .catch(err => {
      alert('ত্রুটি ঘটেছে: ' + err.message);
    });
  }

  // পেজ লোড হলে ইউজার লোড করো
  window.onload = () => {
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
      window.location.href = 'admin-login.html';
    } else {
      loadUsers();
    }
  };
</script>

</body>
</html>
