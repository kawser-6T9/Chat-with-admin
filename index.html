<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>চ্যাট অ্যাপ - ইউজার লগইন</title>
<style>
  /* মোবাইল ফ্রেন্ডলি সুন্দর স্টাইল */
  body, html {
    margin:0; padding:0; height:100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    display: flex; justify-content: center; align-items: center;
  }
  #loginBox {
    background: white;
    padding: 30px 25px;
    border-radius: 15px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    width: 90%;
    max-width: 400px;
    text-align: center;
  }
  #loginBox h2 {
    margin-bottom: 25px;
    color: #2563eb;
  }
  input[type=text], input[type=password] {
    width: 100%;
    padding: 12px 15px;
    margin-bottom: 18px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    outline: none;
    transition: border-color 0.3s ease;
  }
  input[type=text]:focus, input[type=password]:focus {
    border-color: #2563eb;
  }
  button {
    width: 100%;
    padding: 14px 0;
    font-size: 18px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #1d4ed8;
  }
  #errorMsg {
    color: red;
    margin-bottom: 15px;
    min-height: 20px;
  }
  #infoText {
    font-size: 14px;
    margin-top: 15px;
    color: #555;
  }
  #contactLinks {
    margin-top: 10px;
    font-size: 14px;
  }
  #contactLinks a {
    color: #2563eb;
    text-decoration: none;
    margin: 0 5px;
  }
  #contactLinks a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>

<div id="loginBox">
  <h2>চ্যাট অ্যাপে লগইন</h2>
  <div id="errorMsg"></div>
  <input type="text" id="userName" placeholder="আপনার নাম লিখুন" autocomplete="off" />
  <input type="password" id="userPass" placeholder="পাসওয়ার্ড দিন" autocomplete="off" />
  <button id="loginBtn">লগইন করুন</button>
  <div id="infoText">
    নতুন ইউজার? আপনার নাম দিয়ে লগইন করলে অনুমোদনের জন্য রিকোয়েস্ট যাবে। অনুমোদিত হলে আপনি চ্যাট করতে পারবেন।
  </div>
  <div id="contactLinks">
    সাহায্যের জন্য: 
    <a href="https://m.me/kawser.ahmed.88690" target="_blank">Messenger</a> |
    <a href="https://wa.me/+8801750868119" target="_blank">WhatsApp</a>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // Firebase Config (তোমার নিজস্ব config বসাও)
  const firebaseConfig = {
    apiKey: "AIzaSyDJ_KagqCQzTavn4SU81g9XV29k76cNLF8",
    authDomain: "pakhi-e3aad.firebaseapp.com",
    projectId: "pakhi-e3aad",
    storageBucket: "pakhi-e3aad.appspot.com",
    messagingSenderId: "235336322769",
    appId: "1:235336322769:web:6400ff0350ea3c60e2fff0"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const loginBtn = document.getElementById('loginBtn');
  const errorMsg = document.getElementById('errorMsg');
  const userNameInput = document.getElementById('userName');
  const userPassInput = document.getElementById('userPass');

  loginBtn.onclick = async () => {
    errorMsg.textContent = '';
    const name = userNameInput.value.trim();
    const pass = userPassInput.value.trim();

    if (!name) {
      errorMsg.textContent = 'দয়া করে নাম লিখুন।';
      return;
    }
    if (!pass) {
      errorMsg.textContent = 'দয়া করে পাসওয়ার্ড দিন।';
      return;
    }

    try {
      // ইউজার চেক করবো অনুমোদিত কিনা
      const userDoc = await db.collection('users').doc(name).get();

      if (userDoc.exists) {
        const userData = userDoc.data();

        if (userData.banned) {
          errorMsg.textContent = 'আপনি ব্যানড হয়েছেন। যোগাযোগ করুন অ্যাডমিনের সাথে।';
          return;
        }

        if (!userData.approved) {
          errorMsg.textContent = 'আপনার রিকোয়েস্ট এখনও অনুমোদিত হয়নি। অপেক্ষা করুন।';
          return;
        }

        // পাসওয়ার্ড চেক
        if (userData.password !== pass) {
          errorMsg.textContent = 'পাসওয়ার্ড ভুল হয়েছে।';
          return;
        }

        // সফল লগইন, লোকালস্টোরেজে রাখি
        localStorage.setItem('fdUser', name);
        alert('লগইন সফল! এখন চ্যাট পেজে নিয়ে যাওয়া হচ্ছে...');
        window.location.href = 'chat.html';

      } else {
        // নতুন ইউজার, রিকোয়েস্ট পাঠাও
        await db.collection('users').doc(name).set({
          password: pass,
          approved: false,
          banned: false,
          requestedAt: new Date()
        });
        errorMsg.style.color = 'green';
        errorMsg.textContent = 'নতুন রিকোয়েস্ট পাঠানো হয়েছে, অনুমোদনের জন্য অপেক্ষা করুন। অ্যাডমিন অনুমোদন দিলে লগইন করতে পারবেন।';
      }
    } catch (error) {
      console.error(error);
      errorMsg.textContent = 'কিছু সমস্যা হয়েছে, আবার চেষ্টা করুন।';
    }
  };

  // ইন্টার দিয়ে লগইন
  userPassInput.addEventListener('keyup', function(e) {
    if (e.key === 'Enter') loginBtn.click();
  });

</script>

</body>
</html>
