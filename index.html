<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡¶™‡¶æ‡¶ñ‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™</title>
<style>
  body,html {
    margin:0; padding:0; height:100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  #loginDiv, #chatDiv {
    width: 100%;
    max-width: 480px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    padding: 20px;
    display:none;
    flex-direction: column;
    height: 90vh;
  }
  #loginDiv.active, #chatDiv.active {
    display:flex;
  }
  h2 {
    text-align:center;
    margin-bottom: 24px;
    color:#333;
  }
  input {
    padding: 12px 15px;
    font-size: 16px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    outline:none;
  }
  button {
    padding: 12px 15px;
    font-size: 16px;
    background: #3b82f6;
    color: white;
    border:none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
  }
  button:hover {
    background: #2563eb;
  }
  #chatBox {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    background: #fafafa;
  }
  .msg {
    margin-bottom: 10px;
    max-width: 80%;
    padding: 10px 15px;
    border-radius: 15px;
    word-wrap: break-word;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
  }
  .msg.admin {
    background: #e0f7fa;
    align-self: flex-start;
  }
  .msg.me {
    background: #c8e6c9;
    align-self: flex-end;
  }
  .msg .name {
    font-weight: 700;
    font-size: 13px;
    margin-bottom: 5px;
    color: #333;
  }
  .msg img {
    max-width: 150px;
    border-radius: 10px;
    cursor: pointer;
    display: block;
  }
  #inputArea {
    display: flex;
    gap: 8px;
  }
  #inputArea input[type=text] {
    flex: 1;
    padding: 12px 15px;
    font-size: 16px;
    border-radius: 25px;
    border: 1px solid #ccc;
    outline: none;
  }
  #inputArea button {
    border-radius: 25px;
    padding: 12px 20px;
  }
  label[for=fileInput] {
    cursor: pointer;
    font-size: 24px;
    line-height: 30px;
    user-select:none;
  }
  #fileInput {
    display: none;
  }
</style>
</head>
<body>

<div id="loginDiv" class="active">
  <h2>‡¶™‡¶æ‡¶ñ‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
  <input type="text" id="userNameInput" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" autocomplete="off" />
  <input type="password" id="passwordInput" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" autocomplete="off" />
  <button id="loginBtn">‡¶≤‡¶ó‡¶á‡¶®</button>
  <p style="margin-top:15px; font-size:14px; color:#666;">
    ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶≤‡ßá <br>
    <a href="https://m.me/kawser.ahmed.88690" target="_blank">Messenger</a> ‡¶¨‡¶æ <a href="https://wa.me/+8801750868119" target="_blank">WhatsApp</a> ‡¶è ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
  </p>
</div>

<div id="chatDiv">
  <h2>‡¶™‡¶æ‡¶ñ‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü</h2>
  <div id="chatBox"></div>
  <div id="inputArea">
    <input type="text" id="messageInput" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." autocomplete="off" />
    <label for="fileInput" title="‡¶õ‡¶¨‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®">üìé</label>
    <input type="file" id="fileInput" accept="image/*" />
    <button id="sendBtn">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // Firebase configuration (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase ‡¶™‡ßç‡¶∞‡ßã‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶®‡¶´‡¶ø‡¶ó ‡¶¶‡¶ø‡¶®)
  const firebaseConfig = {
    apiKey: "AIzaSyDJ_KagqCQzTavn4SU81g9XV29k76cNLF8",
    authDomain: "pakhi-e3aad.firebaseapp.com",
    projectId: "pakhi-e3aad",
    storageBucket: "pakhi-e3aad.appspot.com",
    messagingSenderId: "235336322769",
    appId: "1:235336322769:web:6400ff0350ea3c60e2fff0"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü (‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã)
  const usersData = {
    "kamrul": "sss",
    "rakib": "rak123",
    "mim": "mim456"
  };

  // DOM ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
  const loginDiv = document.getElementById('loginDiv');
  const chatDiv = document.getElementById('chatDiv');
  const userNameInput = document.getElementById('userNameInput');
  const passwordInput = document.getElementById('passwordInput');
  const loginBtn = document.getElementById('loginBtn');
  const chatBox = document.getElementById('chatBox');
  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');
  const fileInput = document.getElementById('fileInput');

  let currentUser = null; // ‡¶≤‡¶ó‡¶á‡¶®‡¶ï‡ßÉ‡¶§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞

  // ‡¶≤‡¶ó‡¶á‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  loginBtn.onclick = () => {
    const name = userNameInput.value.trim().toLowerCase();
    const pass = passwordInput.value.trim();

    if (!name || !pass) {
      alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§');
      return;
    }
    if (!(name in usersData)) {
      alert('‡¶è‡¶á ‡¶®‡¶æ‡¶Æ‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
      return;
    }
    if (usersData[name] !== pass) {
      alert('‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§');
      return;
    }

    currentUser = name;
    loginDiv.classList.remove('active');
    chatDiv.classList.add('active');

    loadMessages();
  };

  // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç (‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡¶ï‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá)
  function loadMessages() {
    db.collection('messages')
      .orderBy('time')
      .onSnapshot(snapshot => {
        chatBox.innerHTML = '';
        snapshot.forEach(doc => {
          const msg = doc.data();
          // ‡¶∂‡ßÅ‡¶ß‡ßÅ admin ‡¶è‡¶¨‡¶Ç currentUser ‡¶è‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
          if ((msg.sender === currentUser || msg.sender === 'admin') &&
              (msg.receiver === currentUser || msg.receiver === 'admin')) {
            appendMessage(msg);
          }
        });
        chatBox.scrollTop = chatBox.scrollHeight;
      });
  }

  // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú UI ‡¶§‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
  function appendMessage(msg) {
    const div = document.createElement('div');
    div.classList.add('msg');
    div.classList.add(msg.sender === currentUser ? 'me' : 'admin');

    const nameDiv = document.createElement('div');
    nameDiv.classList.add('name');
    nameDiv.textContent = msg.sender === 'admin' ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' : msg.sender;
    div.appendChild(nameDiv);

    if (msg.type === 'image') {
      const img = document.createElement('img');
      img.src = msg.content;
      img.alt = '‡¶õ‡¶¨‡¶ø';
      img.onclick = () => {
        window.open(msg.content, '_blank');
      };
      div.appendChild(img);

      // ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶≤‡¶ø‡¶Ç‡¶ï
      const dlLink = document.createElement('a');
      dlLink.href = msg.content;
      dlLink.download = 'image.jpg';
      dlLink.textContent = '‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®';
      dlLink.style.display = 'block';
      dlLink.style.color = '#2563eb';
      dlLink.style.marginTop = '5px';
      div.appendChild(dlLink);
    } else {
      const textDiv = document.createElement('div');
      textDiv.textContent = msg.content;
      div.appendChild(textDiv);
    }

    chatBox.appendChild(div);
  }

  // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã (text / image)
  async function sendMessage(type, content) {
    if (!currentUser) return;
    if (!content) return;

    let receiver = 'admin'; // ‡¶∏‡¶¨ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡¶ï‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá

    try {
      await db.collection('messages').add({
        sender: currentUser,
        receiver: receiver,
        type: type,
        content: content,
        time: firebase.firestore.FieldValue.serverTimestamp()
      });
      messageInput.value = '';
      chatBox.scrollTop = chatBox.scrollHeight;
    } catch (e) {
      alert('‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
    }
  }

  sendBtn.onclick = () => {
    let text = messageInput.value.trim();
    if (text) sendMessage('text', text);
  };

  messageInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

  // ‡¶á‡¶Æ‡ßá‡¶ú ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°
  fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (!file) return;

    if (!file.type.startsWith('image/')) {
      alert('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶õ‡¶¨‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
      fileInput.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = e => {
      sendMessage('image', e.target.result);
      fileInput.value = '';
    };
    reader.readAsDataURL(file);
  };
</script>

</body>
</html>
