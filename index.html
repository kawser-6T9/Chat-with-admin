<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pakhi Chat - User Chat with Admin</title>
<style>
  /* Basic reset & fonts */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    display: flex; flex-direction: column;
  }

  header {
    background: #0b5ed7;
    color: white;
    padding: 15px 20px;
    font-size: 22px;
    font-weight: 700;
    text-align: center;
  }

  #loginSection {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  #loginSection input {
    width: 100%;
    max-width: 320px;
    padding: 12px 15px;
    margin: 8px 0;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  #loginSection button {
    max-width: 320px;
    width: 100%;
    background: #0b5ed7;
    color: white;
    font-weight: 700;
    padding: 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
  }
  #loginSection button:hover {
    background: #084298;
  }
  #loginError {
    color: red;
    margin-top: 10px;
    font-weight: 600;
  }

  /* Chat Section */
  #chatSection {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  #chatBox {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    background: white;
  }
  .msg {
    max-width: 80%;
    margin-bottom: 15px;
    padding: 12px 15px;
    border-radius: 15px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    word-wrap: break-word;
    position: relative;
  }
  .msg.user {
    background: #dcf8c6;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
  }
  .msg.admin {
    background: #e9ecef;
    align-self: flex-start;
    border-bottom-left-radius: 4px;
  }
  .msg .sender {
    font-weight: 700;
    margin-bottom: 6px;
    font-size: 14px;
    color: #444;
  }
  .msg img {
    max-width: 180px;
    border-radius: 10px;
    display: block;
    margin-top: 6px;
  }
  .msg a.downloadLink {
    display: inline-block;
    margin-top: 6px;
    color: #0b5ed7;
    text-decoration: underline;
    cursor: pointer;
    font-size: 14px;
  }

  /* Input area */
  #inputArea {
    display: flex;
    padding: 10px;
    background: #fff;
    border-top: 1px solid #ccc;
    gap: 8px;
  }
  #inputArea input[type="text"] {
    flex: 1;
    border-radius: 25px;
    border: 1px solid #ccc;
    padding: 10px 15px;
    font-size: 16px;
    outline: none;
  }
  #inputArea input[type="file"] {
    display: none;
  }
  #inputArea label {
    background: #0b5ed7;
    color: white;
    font-weight: 700;
    padding: 0 14px;
    border-radius: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    font-size: 20px;
  }
  #inputArea button {
    background: #0b5ed7;
    border: none;
    color: white;
    font-weight: 700;
    border-radius: 25px;
    padding: 10px 20px;
    cursor: pointer;
    user-select: none;
    font-size: 16px;
  }
  #inputArea button:hover, #inputArea label:hover {
    background: #084298;
  }

  /* Scrollbar */
  #chatBox::-webkit-scrollbar {
    width: 6px;
  }
  #chatBox::-webkit-scrollbar-thumb {
    background-color: #0b5ed7;
    border-radius: 10px;
  }

</style>
</head>
<body>

<header>Pakhi Chat - Admin ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü</header>

<div id="loginSection">
  <input type="text" id="usernameInput" placeholder="‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßã" autocomplete="off" />
  <input type="password" id="passwordInput" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®" autocomplete="off" />
  <button id="loginBtn">‡¶≤‡¶ó‡¶á‡¶®</button>
  <div id="loginError"></div>
</div>

<div id="chatSection" style="display:none; flex-direction: column; height: 100vh;">
  <div id="chatBox"></div>
  <div id="inputArea">
    <input type="text" id="messageInput" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." autocomplete="off" />
    <label for="imageInput" title="‡¶õ‡¶¨‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®">üì∑</label>
    <input type="file" id="imageInput" accept="image/*" />
    <button id="sendBtn">‡¶™‡¶æ‡¶†‡¶æ‡¶ì</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // Firebase config (pakhi-e3aad)
  const firebaseConfig = {
    apiKey: "AIzaSyDJ_KagqCQzTavn4SU81g9XV29k76cNLF8",
    authDomain: "pakhi-e3aad.firebaseapp.com",
    projectId: "pakhi-e3aad",
    storageBucket: "pakhi-e3aad.firebasestorage.app",
    messagingSenderId: "235336322769",
    appId: "1:235336322769:web:6400ff0350ea3c60e2fff0"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ó‡ßÅ‡¶≤‡ßã
  const usersData = {
    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞-‡¶®‡ßá‡¶Æ: ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá (admin panel ‡¶•‡ßá‡¶ï‡ßá)
    // ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£:
    'kamrul': '1234',
    'sohel': '5678',
    'rana': 'abcd'
  };

  let currentUser = null;

  const loginSection = document.getElementById('loginSection');
  const chatSection = document.getElementById('chatSection');
  const usernameInput = document.getElementById('usernameInput');
  const passwordInput = document.getElementById('passwordInput');
  const loginBtn = document.getElementById('loginBtn');
  const loginError = document.getElementById('loginError');
  const chatBox = document.getElementById('chatBox');
  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');
  const imageInput = document.getElementById('imageInput');

  // ‡¶≤‡¶ó‡¶á‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  loginBtn.onclick = () => {
    const name = usernameInput.value.trim();
    const pass = passwordInput.value.trim();

    if (!name || !pass) {
      loginError.textContent = "‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§";
      return;
    }
    // ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á (local object ‡¶•‡ßá‡¶ï‡ßá)
    if (usersData[name] && usersData[name] === pass) {
      currentUser = name;
      loginSection.style.display = 'none';
      chatSection.style.display = 'flex';
      loginError.textContent = '';
      loadMessages();
    } else {
      loginError.textContent = "‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!";
    }
  };

  // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶ì ‡¶∞‡¶ø‡ßü‡ßá‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
  function loadMessages() {
    db.collection('messages')
      .orderBy('time', 'asc')
      .onSnapshot(snapshot => {
        chatBox.innerHTML = '';
        snapshot.forEach(doc => {
          const msg = doc.data();
          appendMessage(doc.id, msg);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
      });
  }

  // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú UI ‡¶§‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
  function appendMessage(id, msg) {
    const div = document.createElement('div');
    div.classList.add('msg');
    if (msg.sender === currentUser) {
      div.classList.add('user');
    } else if (msg.sender === 'admin') {
      div.classList.add('admin');
    } else {
      // ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßá‡¶â ‡¶π‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶®‡¶æ (admin ‡¶õ‡¶æ‡ßú‡¶æ ‡¶ï‡ßá‡¶â ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá ‡¶®‡¶æ)
      return;
    }

    const senderSpan = document.createElement('div');
    senderSpan.className = 'sender';
    senderSpan.textContent = msg.sender === currentUser ? '‡¶§‡ßÅ‡¶Æ‡¶ø' : 'Admin';

    div.appendChild(senderSpan);

    if (msg.type === 'image') {
      const img = document.createElement('img');
      img.src = msg.content;
      div.appendChild(img);

      // ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï
      const link = document.createElement('a');
      link.href = msg.content;
      link.download = `image_${id}.jpg`;
      link.textContent = "‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®";
      link.className = "downloadLink";
      div.appendChild(link);

    } else {
      const p = document.createElement('p');
      p.textContent = msg.content;
      div.appendChild(p);
    }

    chatBox.appendChild(div);
  }

  // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  sendBtn.onclick = async () => {
    const text = messageInput.value.trim();
    if (!text && !imageInput.files.length) return;

    if (imageInput.files.length) {
      // ‡¶á‡¶Æ‡ßá‡¶ú ‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡ßá‡¶ú64 ‡¶è ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞
      const file = imageInput.files[0];
      const reader = new FileReader();
      reader.onload = async (e) => {
        const base64 = e.target.result;
        await sendMessageToDB('image', base64);
        imageInput.value = '';
      };
      reader.readAsDataURL(file);
    } else {
      else {
      // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
      await sendMessageToDB('text', text);
      messageInput.value = '';
    }
  };

  // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  async function sendMessageToDB(type, content) {
    try {
      await db.collection('messages').add({
        sender: currentUser,
        time: firebase.firestore.FieldValue.serverTimestamp(),
        type: type,
        content: content
      });
      // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶°‡¶æ‡¶â‡¶®
      chatBox.scrollTop = chatBox.scrollHeight;
    } catch (e) {
      alert('‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
    }
  }

  // Enter ‡¶ö‡¶æ‡¶™‡¶≤‡ßá‡¶á ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ø‡¶æ‡¶¨‡ßá (‡¶∂‡¶ø‡¶´‡¶ü+‡¶è‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶π‡¶≤‡ßá)
  messageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

</script>

</body>
</html>
