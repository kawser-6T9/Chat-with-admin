<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>অ্যাডমিন ড্যাশবোর্ড</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<style>
  body, html {
    margin:0; padding:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    min-height: 100vh;
    display: flex; flex-direction: column;
  }
  header {
    background: #2563eb;
    color: white;
    padding: 15px 20px;
    font-size: 22px;
    font-weight: 700;
    user-select:none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header button.logoutBtn {
    background: #f87171;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  header button.logoutBtn:hover {
    background: #dc2626;
  }

  main {
    flex: 1;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }

  h2 {
    color: #111827;
    margin-bottom: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    text-align: left;
    padding: 12px 15px;
    border-bottom: 1px solid #e5e7eb;
  }
  th {
    background: #3b82f6;
    color: white;
  }
  tr:hover {
    background: #bfdbfe;
  }

  /* Responsive */
  @media (max-width:600px) {
    th, td {
      padding: 10px 8px;
      font-size: 14px;
    }
  }
  button.actionBtn {
    margin-right: 8px;
    padding: 6px 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    color: white;
  }
  button.approve {
    background: #22c55e;
  }
  button.reject {
    background: #ef4444;
  }
  button.ban {
    background: #dc2626;
  }
  button.unban {
    background: #2563eb;
  }
</style>
</head>
<body>

<header>
  অ্যাডমিন ড্যাশবোর্ড
  <button class="logoutBtn" id="logoutBtn">লগআউট</button>
</header>

<main>

  <h2>অনুমোদিত ইউজার</h2>
  <table id="userTable">
    <thead>
      <tr>
        <th>নাম</th>
        <th>লগইন সময়</th>
        <th>স্ট্যাটাস</th>
        <th>অ্যাকশন</th>
      </tr>
    </thead>
    <tbody>
      <!-- ইউজার লিস্ট এখানে দেখানো হবে -->
    </tbody>
  </table>

  <h2 style="margin-top: 40px;">অ্যাপ্রুভের অপেক্ষমাণ ইউজার</h2>
  <div id="pendingUsers">
    <!-- পেন্ডিং ইউজার দেখাবে এখানে -->
  </div>

</main>

<script>
  // Firebase Config তোমার নিজস্ব Firebase প্রজেক্টের সেটিংস বসাও
  const firebaseConfig = {
    apiKey: "AIzaSyDJ_KagqCQzTavn4SU81g9XV29k76cNLF8",
    authDomain: "pakhi-e3aad.firebaseapp.com",
    projectId: "pakhi-e3aad",
    storageBucket: "pakhi-e3aad.firebasestorage.app",
    messagingSenderId: "235336322769",
    appId: "1:235336322769:web:6400ff0350ea3c60e2fff0"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // লগআউট বাটন কাজ
  document.getElementById('logoutBtn').onclick = () => {
    localStorage.removeItem('adminLoggedIn');
    window.location.href = 'admin-login.html';
  };

  // ইউজার তালিকা লোড করা (অ্যাপ্রুভড ইউজার)
  function loadUsers() {
    const tbody = document.querySelector('#userTable tbody');
    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">লোড হচ্ছে...</td></tr>';

    db.collection('users')
      .where('approved', '==', true)
      .get()
      .then(snapshot => {
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">কোনো ইউজার নেই</td></tr>';
          return;
        }
        tbody.innerHTML = '';
        snapshot.forEach(doc => {
          const user = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${user.name}</td>
            <td>${user.loginTime || '-'}</td>
            <td>${user.banned ? '<span style="color:red;">ব্যান</span>' : '<span style="color:green;">সক্রিয়</span>'}</td>
            <td>
              ${user.banned 
                ? `<button class="actionBtn unban" onclick="toggleBan('${doc.id}', false)">আনব্যান</button>`
                : `<button class="actionBtn ban" onclick="toggleBan('${doc.id}', true)">ব্যান</button>`}
            </td>
          `;
          tbody.appendChild(tr);
        });
      })
      .catch(err => {
        tbody.innerHTML = `<tr><td colspan="4" style="color:red;">ত্রুটি: ${err.message}</td></tr>`;
      });
  }

  // পেন্ডিং ইউজার লোড করা
  function loadPendingUsers() {
    const pendingSection = document.getElementById('pendingUsers');
    pendingSection.innerHTML = '<p>লোড হচ্ছে...</p>';

    db.collection('users')
      .where('approved', '==', false)
      .get()
      .then(snapshot => {
        if (snapshot.empty) {
          pendingSection.innerHTML = '<p>কোনো অনুমোদনের অপেক্ষমাণ ইউজার নেই।</p>';
          return;
        }
        pendingSection.innerHTML = '';
        snapshot.forEach(doc => {
          const user = doc.data();
          const div = document.createElement('div');
          div.style.marginBottom = '12px';

          div.innerHTML = `
            <strong>${user.name}</strong>
            <button class="actionBtn approve" onclick="approveUser('${doc.id}')">অ্যাপ্রুভ</button>
            <button class="actionBtn reject" onclick="rejectUser('${doc.id}')">রিজেক্ট</button>
          `;
          pendingSection.appendChild(div);
        });
      })
      .catch(err => {
        pendingSection.innerHTML = `<p style="color:red;">ত্রুটি: ${err.message}</p>`;
      });
  }

  // ইউজার অনুমোদন ফাংশন
  function approveUser(docId) {
    db.collection('users').doc(docId).update({ approved: true })
      .then(() => {
        alert('ইউজার অনুমোদিত হয়েছে');
        loadPendingUsers();
        loadUsers();
      })
      .catch(err => alert('ত্রুটি: ' + err.message));
  }

  // ইউজার রিজেক্ট/মুছে ফেলা ফাংশন
  function rejectUser(docId) {
    db.collection('users').doc(docId).delete()
      .then(() => {
        alert('ইউজার রিজেক্ট ও মুছে ফেলা হয়েছে');
        loadPendingUsers();
      })
      .catch(err => alert('ত্রুটি: ' + err.message));
  }

  // ইউজার ব্যান / আনব্যান ফাংশন
  function toggleBan(docId, banStatus) {
    db.collection('users').doc(docId).update({ banned: banStatus })
      .then(() => {
        alert(banStatus ? 'ইউজার ব্যান হয়েছে' : 'ইউজার আনব্যান হয়েছে');
        loadUsers();
      })
      .catch(err => alert('ত্রুটি: ' + err.message));
  }

  // পেজ লোডে লগইন চেক ও ডাটা লোড করো
  window.onload = () => {
    if (!localStorage.getItem('adminLoggedIn')) {
      window.location.href = 'admin-login.html';
      return;
    }
    loadUsers();
    loadPendingUsers();
  };
</script>

</body>
</html>
